
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>GeorgeFinal</title><meta name="generator" content="MATLAB 9.8"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2020-12-10"><meta name="DC.source" content="GeorgeFinal.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">Introduction</a></li><li><a href="#2">Problem 1</a></li><li><a href="#3">Problem 2</a></li><li><a href="#4">Problem 3</a></li></ul></div><h2 id="1">Introduction</h2><pre class="codeinput"><span class="comment">%Aldous George</span>
<span class="comment">%EP 501</span>
<span class="comment">%Final Exam</span>
<span class="comment">%This code contains excerpts from codes provided by Dr. Zettergen.</span>
<span class="comment">%https://github.com/Zettergren-Courses/EP501_matlab/</span>
clc
clearvars
close <span class="string">all</span>
</pre><h2 id="2">Problem 1</h2><pre class="codeinput">n = 100;
dt = linspace(0,1,n);
alpha = 4;
G=zeros(1,n);
<span class="keyword">for</span> i=1:n
        G(i) = 1-(dt(i)*alpha)+(0.5*(dt(i)*alpha)^2)-<span class="keyword">...</span>
            ((1/6)*(dt(i)*alpha)^3)+((1/24)*(dt(i)*alpha)^4);
<span class="keyword">end</span>

figure(1);
alphadt=alpha.*dt;
plot(alphadt,G,<span class="string">'o'</span>);
set(gca,<span class="string">'FontSize'</span>,15);
ylabel(<span class="string">'G'</span>);
xlabel(<span class="string">'\alpha \Delta t'</span>);
hold <span class="string">on</span>
plot(0:0.04:4,ones(101),<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,2);
legend(<span class="string">'Gain factor'</span>,<span class="string">'Stability limit line'</span>,<span class="string">'Location'</span>,<span class="string">'NorthWest'</span>);
title(<span class="string">'G vs \alpha dt (\alpha = 4)'</span>)

<span class="comment">%1-c</span>
x=linspace(0,20,1000);        <span class="comment">%radial independent variable</span>
maxit =100;              <span class="comment">%Max Iterations</span>
tol=1e-3;                <span class="comment">%Tolerance</span>
verbose =false;
g = @objfun1;
gprime = @objgradfun1;
ygrid=g(x);
g2 = @objfun2;
ygrid2 = ygrid+2;

<span class="keyword">for</span> j=1:2
    x0=(j-1);    <span class="comment">%Initial condition x_i</span>
    [R(j),it,success]=newton_exact(g,gprime,x0,maxit,tol,verbose);
<span class="keyword">end</span>
disp([<span class="string">'Real Roots: '</span>, num2str(R)]);
figure(2)
subplot(1,2,1)
plot(x,ygrid)
set(gca,<span class="string">'FontSize'</span>,15);
ylim([-1,10]);
xlabel(<span class="string">'\Delta t'</span>);
ylabel(<span class="string">'gain factor'</span>);
title(<span class="string">'G(\alpha ,\Delta t)-1 = 0'</span>)
subplot(1,2,2)
plot(x,ygrid2)
set(gca,<span class="string">'FontSize'</span>,15);
ylim([-1,10]);
title(<span class="string">'1-b) G(\alpha ,\Delta t)+1 = 0'</span>)
xlabel(<span class="string">'\Delta t'</span>);
ylabel(<span class="string">'gain factor'</span>);

<span class="comment">%1-d</span>
<span class="comment">%Gridding in time</span>
N=16;
tmin=0;
tmax=10;
t=linspace(tmin,tmax,N);
<span class="comment">%t=[tmin:R(2):tmax];</span>
dt=t(2)-t(1);

<span class="comment">%true solution</span>
y0=1;
ybar=y0*exp(-alpha*t);

<span class="comment">%RK2</span>
yRK2=zeros(1,N);
yRK2(1)=y0;
<span class="keyword">for</span> n=2:N
    yhalf=yRK2(n-1)+dt/2*(-alpha*yRK2(n-1));
    yRK2(n)=yRK2(n-1)+dt*(-alpha*yhalf);
<span class="keyword">end</span> <span class="comment">%for</span>

<span class="comment">%RK4</span>
yRK4=zeros(1,N);
yRK4(1)=y0;
<span class="keyword">for</span> n=2:N
    dy1=dt*fRK(t(n-1),yRK4(n-1),alpha);
    dy2=dt*fRK(t(n-1)+dt/2,yRK4(n-1)+dy1/2,alpha);
    dy3=dt*fRK(t(n-1)+dt/2,yRK4(n-1)+dy2/2,alpha);
    dy4=dt*fRK(t(n-1)+dt,yRK4(n-1)+dy3,alpha);

    yRK4(n)=yRK4(n-1)+1/6*(dy1+2*dy2+2*dy3+dy4);
<span class="keyword">end</span> <span class="comment">%for</span>

figure(3);
clf;
plot(t,ybar,<span class="string">'o-'</span>);
xlabel(<span class="string">'t'</span>);
ylabel(<span class="string">'y(t)'</span>);
set(gca,<span class="string">'FontSize'</span>,15);
hold <span class="string">on</span>;
plot(t,yRK2,<span class="string">'--'</span>)
plot(t,yRK4,<span class="string">'^-'</span>)
ylim([0,8]);
legend(<span class="string">'Exact'</span>,<span class="string">'RK2'</span>,<span class="string">'RK4'</span>)
title(<span class="string">'1-d) f(t,y) = -\alpha y'</span>);

<span class="comment">%1-e</span>
<span class="comment">%Gridding in time</span>
<span class="comment">%Recalculating below the limit</span>
N=15;                           <span class="comment">%Slightly below the limit</span>
t=linspace(tmin,20,N);
dt=t(2)-t(1);

ybar=y0*exp(-alpha*t);

<span class="comment">%RK4</span>
yRK4=zeros(1,N);
yRK4(1)=y0;
<span class="keyword">for</span> n=2:N
    dy1=dt*fRK(t(n-1),yRK4(n-1),alpha);
    dy2=dt*fRK(t(n-1)+dt/2,yRK4(n-1)+dy1/2,alpha);
    dy3=dt*fRK(t(n-1)+dt/2,yRK4(n-1)+dy2/2,alpha);
    dy4=dt*fRK(t(n-1)+dt,yRK4(n-1)+dy3,alpha);

    yRK4(n)=yRK4(n-1)+1/6*(dy1+2*dy2+2*dy3+dy4);
<span class="keyword">end</span> <span class="comment">%for</span>

figure(4);
subplot(1,2,1);
plot(t,ybar,<span class="string">'o-'</span>);
xlabel(<span class="string">'t'</span>);
ylabel(<span class="string">'y(t)'</span>);
set(gca,<span class="string">'FontSize'</span>,15);
hold <span class="string">on</span>
plot(t,yRK4,<span class="string">'^-'</span>)
legend(<span class="string">'Exact'</span>,<span class="string">'RK4'</span>)
title(<span class="string">'1-e) \Delta t = 0.7143'</span>);

<span class="comment">%Recalculating above the limit</span>
N=16;                           <span class="comment">%Slightly above the limit</span>
t=linspace(tmin,tmax,N);
dt=t(2)-t(1);

ybar=y0*exp(-alpha*t);

<span class="comment">%RK4</span>
yRK4=zeros(1,N);
yRK4(1)=y0;
<span class="keyword">for</span> n=2:N
    dy1=dt*fRK(t(n-1),yRK4(n-1),alpha);
    dy2=dt*fRK(t(n-1)+dt/2,yRK4(n-1)+dy1/2,alpha);
    dy3=dt*fRK(t(n-1)+dt/2,yRK4(n-1)+dy2/2,alpha);
    dy4=dt*fRK(t(n-1)+dt,yRK4(n-1)+dy3,alpha);

    yRK4(n)=yRK4(n-1)+1/6*(dy1+2*dy2+2*dy3+dy4);
<span class="keyword">end</span> <span class="comment">%for</span>

figure(4);
subplot(1,2,2);
plot(t,ybar,<span class="string">'o-'</span>);
xlabel(<span class="string">'t'</span>);
ylabel(<span class="string">'y(t)'</span>);
set(gca,<span class="string">'FontSize'</span>,15);
hold <span class="string">on</span>
plot(t,yRK4,<span class="string">'^-'</span>)
<span class="comment">% ylim([0,8]);</span>
legend(<span class="string">'Exact'</span>,<span class="string">'RK4'</span>)
title(<span class="string">'1-e) \Delta t = 0.6667'</span>);
</pre><pre class="codeoutput">Real Roots: 0     0.69646
</pre><img vspace="5" hspace="5" src="GeorgeFinal_01.png" alt=""> <img vspace="5" hspace="5" src="GeorgeFinal_02.png" alt=""> <img vspace="5" hspace="5" src="GeorgeFinal_03.png" alt=""> <img vspace="5" hspace="5" src="GeorgeFinal_04.png" alt=""> <h2 id="3">Problem 2</h2><pre class="codeinput">clc
clearvars
close <span class="string">all</span>

<span class="comment">%2-b</span>
lx=50;
x=linspace(-10,10,lx)';
y=cos(x);                   <span class="comment">%y def</span>
ytripleprime=sin(x);

figure();
plot(x,y);
hold <span class="string">on</span>;
plot(x,ytripleprime);

dy3_dx=zeros(lx,1);
dx=x(2)-x(1);

den=dx^3;

<span class="comment">%forward difference at the beginning</span>
dy3_dx(1)=(y(4)-3*y(3)+3*y(2)-y(1))/den;

<span class="keyword">for</span> ix=2:lx-2
    dy3_dx(ix)=(y(ix+2)-3*y(ix+1)+3*y(ix)-y(ix-1))/den;
<span class="keyword">end</span> <span class="comment">%for</span>

<span class="comment">%backward difference at the end</span>
dy3_dx(lx-1)=(y(lx-1)-3*y(lx-2)+3*y(lx-3)-y(lx-4))/den;
dy3_dx(lx)=(y(lx)-3*y(lx-1)+3*y(lx-2)-y(lx-3))/den;

x=linspace(-10,10,lx)';
plot(x,dy3_dx,<span class="string">'k--'</span>)
legend(<span class="string">'Orginal function'</span>, <span class="string">'Analytical'</span>, <span class="string">'Numerical'</span>);
xlabel(<span class="string">'x'</span>);
ylabel(<span class="string">'y(x) or y''''''(x)'</span>);
title(<span class="string">'2-b) Comparison of third derivative approximations'</span>);
xlim([0 2*pi]);


<span class="comment">%2-d</span>
disp(<span class="string">'2-d)'</span>);

M = [ -2,2,-4/3,2/3; -1,1/2,-1/6,1/24; 1,1/2,1/6,1/24; 2,2,4/3,2/3];
[L,U] = DLUfactor(M);
nref=length(M);
InvM=[];
<span class="keyword">for</span> ir=1:nref
    B=zeros(nref,1);
    B(ir) = 1;
    <span class="comment">%Forward sub for b'</span>
    Bprime=LTriForwardSub(L,B);
    <span class="comment">%Back substitution for x</span>
    x=backsub(cat(2,U,Bprime)); <span class="comment">%ith column of the Inverse</span>
    InvM=cat(2,InvM,x);
<span class="keyword">end</span> <span class="comment">%for</span>
disp(<span class="string">'Inverse of M:  '</span>);
disp(InvM);

<span class="comment">%2-f</span>
disp(<span class="string">'2-f'</span>);
x=linspace(-10,10,lx)';
y=cos(x);
f4prime=cos(x);

figure();
plot(x,y);
hold <span class="string">on</span>;
plot(x,f4prime);

den=dx^4;
<span class="comment">%forward difference at the beginning</span>
dy4_dx(1)=(y(5)-4*y(4)+6*y(3)-4*y(2)+y(1))/den;
dy4_dx(2)=(y(6)-4*y(5)+6*y(4)-4*y(3)+y(2))/den;

<span class="keyword">for</span> ix=3:lx-2
    dy4_dx(ix)=(y(ix+2)-4*y(ix+1)+6*y(ix)-4*y(ix-1)+y(ix-2))/den;
<span class="keyword">end</span> <span class="comment">%for</span>

<span class="comment">%backward difference at the end</span>
dy4_dx(lx-1)=(y(lx-1)-4*y(lx-2)+6*y(lx-3)-4*y(lx-4)+y(lx-5))/den;
dy4_dx(lx)=(y(lx)-4*y(lx-1)+6*y(lx-2)-4*y(lx-3)+y(lx-4))/den;

x=linspace(-10,10,lx)';
plot(x,dy4_dx,<span class="string">'k--'</span>)
legend(<span class="string">'Orginal function'</span>, <span class="string">'Analytical'</span>, <span class="string">'Numerical'</span>);
xlabel(<span class="string">'x'</span>);
ylabel(<span class="string">'y(x) or y''''''(x)'</span>);
title(<span class="string">'2-f) Comparison of Fourth derivative approximations'</span>);
xlim([0 2*pi]);

<span class="comment">%2-g</span>
disp(<span class="string">'2-g'</span>);
n=6;
<span class="keyword">for</span> j=1:n
    <span class="keyword">for</span> k=1:n
        M(j,k)= ((n/2)+1-j)^k/(factorial(k));
        <span class="keyword">if</span> (n/2)+1-j&lt;=0
            M(j,k)=((n/2)-j)^k/factorial(k);
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
M=flip(M);
disp(M);

<span class="comment">%Inverse of M</span>

[L,U] = DLUfactor(M);
nref=length(M);
InvM=[];
<span class="keyword">for</span> ir=1:nref
    B=zeros(nref,1);
    B(ir) = 1;
    <span class="comment">%Forward sub for b'</span>
    Bprime=LTriForwardSub(L,B);
    <span class="comment">%Back substitution for x</span>
    x=backsub(cat(2,U,Bprime)); <span class="comment">%ith column of the Inverse</span>
    InvM=cat(2,InvM,x);
<span class="keyword">end</span> <span class="comment">%for</span>
disp(<span class="string">'Inverse of M:  '</span>);
disp(InvM);
</pre><pre class="codeoutput">2-d)
Inverse of M:  
    0.0833   -0.6667    0.6667   -0.0833
   -0.0833    1.3333    1.3333   -0.0833
   -0.5000    1.0000   -1.0000    0.5000
    1.0000   -4.0000   -4.0000    1.0000

2-f
2-g
   -3.0000    4.5000   -4.5000    3.3750   -2.0250    1.0125
   -2.0000    2.0000   -1.3333    0.6667   -0.2667    0.0889
   -1.0000    0.5000   -0.1667    0.0417   -0.0083    0.0014
    1.0000    0.5000    0.1667    0.0417    0.0083    0.0014
    2.0000    2.0000    1.3333    0.6667    0.2667    0.0889
    3.0000    4.5000    4.5000    3.3750    2.0250    1.0125

Inverse of M:  
   -0.0167    0.1500   -0.7500    0.7500   -0.1500    0.0167
    0.0111   -0.1500    1.5000    1.5000   -0.1500    0.0111
    0.1250   -1.0000    1.6250   -1.6250    1.0000   -0.1250
   -0.1667    2.0000   -6.5000   -6.5000    2.0000   -0.1667
   -0.5000    2.0000   -2.5000    2.5000   -2.0000    0.5000
    1.0000   -6.0000   15.0000   15.0000   -6.0000    1.0000

</pre><img vspace="5" hspace="5" src="GeorgeFinal_05.png" alt=""> <img vspace="5" hspace="5" src="GeorgeFinal_06.png" alt=""> <h2 id="4">Problem 3</h2><pre class="codeinput">clc
clearvars
close <span class="string">all</span>

<span class="comment">%Parameters</span>
lamda=2;
dx=1/64;
lx=65;
dt=5*dx^2/(2*lamda);
x=0:dx:1;


tmax=1024*(1/(lamda*2*pi/(2*dx)^2));
t=0:dt:tmax;
lt=numel(t);

<span class="comment">%Boundary Conditions</span>
f=zeros(lx,lt);
f(:,lt)=sin(2*pi*x)+sin(8*pi*x);

A=zeros(lx,lx);
b=zeros(1,lx);
<span class="comment">%b</span>
ff=f;
<span class="comment">%Euler iterations</span>
<span class="keyword">for</span> n=lt-1:-1:2
    A(1,1)=1;
    b(1)=0;
    <span class="keyword">for</span> i=2:lx-1     <span class="comment">%interior grid points</span>
        <span class="comment">%i-1 coeff</span>
        A(i,i-1)=-lamda/2/dx^2;

        <span class="comment">%i coeff</span>
        A(i,i)=1/dt+lamda/dx^2;

        <span class="comment">%i+1 coeff</span>
        A(i,i+1)=-lamda/2/dx^2;

        b(i)=ff(i,n+1)/dt+(ff(i+1,n+1)-2*ff(i,n+1)+ff(i-1,n+1))/dx^2*(lamda/2);
    <span class="keyword">end</span> <span class="comment">%for</span>
    A(lx,lx)=1;
    b(lx)=0;

    [Amod,ord] = Gauss_elim(A,b',false);
    fnow=backsub(Amod(ord,:));
    ff(:,n)=fnow;
<span class="keyword">end</span> <span class="comment">%for</span>
ff=flip(ff,2);

<span class="comment">%d</span>
fs=f;
<span class="comment">%second order iteration</span>
<span class="keyword">for</span> n=lt-1:-1:2
    A(1,1)=1;
    b(1)=0;
    <span class="keyword">for</span> i=2:lx-1     <span class="comment">%interior grid points</span>
        <span class="comment">%i-1 coeff</span>
        A(i,i-1)=-lamda/dx^2;

        <span class="comment">%i coeff</span>
        A(i,i)=3/dt+2*lamda/dx^2;

        <span class="comment">%i+1 coeff</span>
        A(i,i+1)=-lamda/dx^2;

        b(i)=(3*fs(i,n+1)+fs(i,n-1))/dt+(ff(i+1,n+1)-2*ff(i,n+1)+ff(i-1,n+1))/dx^2*(lamda);
    <span class="keyword">end</span> <span class="comment">%for</span>
    A(lx,lx)=1;
    b(lx)=0;

    [Amod,ord] = Gauss_elim(A,b',false);
    fnow=backsub(Amod(ord,:));
    fs(:,n)=fnow;
<span class="keyword">end</span> <span class="comment">%for</span>
fs=flip(fs,2);


figure(1);
subplot(131);
imagesc(t,x,ff);
colorbar;
axis <span class="string">xy</span>;
xlabel(<span class="string">'time (s)'</span>);
ylabel(<span class="string">'x (m)'</span>)
title(<span class="string">'Euler'</span>)
set(gca,<span class="string">'FontSize'</span>,16);

subplot(132);
imagesc(t,x,fs);
colorbar;
axis <span class="string">xy</span>;
xlabel(<span class="string">'time (s)'</span>);
ylabel(<span class="string">'x (m)'</span>)
title(<span class="string">'Second order'</span>)
set(gca,<span class="string">'FontSize'</span>,16);

<span class="comment">%Compute and plot the analytical solution (see course repository ./test_problems/ for derivation)</span>
[T,X]=meshgrid(t,x);
exact=exp(-4*pi^2*lamda*T).*sin(2*pi*X)+exp(-64*pi^2*lamda*T).*sin(8*pi*X);

figure(1);
subplot(133);
imagesc(t,x,exact);
colorbar;
axis <span class="string">xy</span>;
xlabel(<span class="string">'time (s)'</span>);
ylabel(<span class="string">'x (m)'</span>);
title(<span class="string">'Exact'</span>);
set(gca,<span class="string">'FontSize'</span>,16);
</pre><img vspace="5" hspace="5" src="GeorgeFinal_07.png" alt=""> <p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Introduction
%Aldous George
%EP 501
%Final Exam
%This code contains excerpts from codes provided by Dr. Zettergen.
%https://github.com/Zettergren-Courses/EP501_matlab/
clc
clearvars
close all
%% Problem 1

n = 100;
dt = linspace(0,1,n);
alpha = 4;
G=zeros(1,n);
for i=1:n
        G(i) = 1-(dt(i)*alpha)+(0.5*(dt(i)*alpha)^2)-...
            ((1/6)*(dt(i)*alpha)^3)+((1/24)*(dt(i)*alpha)^4);
end

figure(1);
alphadt=alpha.*dt;
plot(alphadt,G,'o');
set(gca,'FontSize',15);
ylabel('G');
xlabel('\alpha \Delta t');
hold on
plot(0:0.04:4,ones(101),'r','LineWidth',2);
legend('Gain factor','Stability limit line','Location','NorthWest');
title('G vs \alpha dt (\alpha = 4)')

%1-c
x=linspace(0,20,1000);        %radial independent variable
maxit =100;              %Max Iterations 
tol=1e-3;                %Tolerance
verbose =false;
g = @objfun1;
gprime = @objgradfun1;
ygrid=g(x);
g2 = @objfun2;
ygrid2 = ygrid+2;

for j=1:2
    x0=(j-1);    %Initial condition x_i
    [R(j),it,success]=newton_exact(g,gprime,x0,maxit,tol,verbose);
end
disp(['Real Roots: ', num2str(R)]);
figure(2)
subplot(1,2,1)
plot(x,ygrid)
set(gca,'FontSize',15);
ylim([-1,10]);
xlabel('\Delta t');
ylabel('gain factor');
title('G(\alpha ,\Delta t)-1 = 0')
subplot(1,2,2)
plot(x,ygrid2)
set(gca,'FontSize',15);
ylim([-1,10]);
title('1-b) G(\alpha ,\Delta t)+1 = 0')
xlabel('\Delta t');
ylabel('gain factor');

%1-d 
%Gridding in time
N=16;
tmin=0;
tmax=10;
t=linspace(tmin,tmax,N);
%t=[tmin:R(2):tmax];
dt=t(2)-t(1);

%true solution
y0=1;
ybar=y0*exp(-alpha*t);

%RK2
yRK2=zeros(1,N);
yRK2(1)=y0;
for n=2:N
    yhalf=yRK2(n-1)+dt/2*(-alpha*yRK2(n-1));
    yRK2(n)=yRK2(n-1)+dt*(-alpha*yhalf);
end %for

%RK4
yRK4=zeros(1,N);
yRK4(1)=y0;
for n=2:N
    dy1=dt*fRK(t(n-1),yRK4(n-1),alpha);
    dy2=dt*fRK(t(n-1)+dt/2,yRK4(n-1)+dy1/2,alpha);
    dy3=dt*fRK(t(n-1)+dt/2,yRK4(n-1)+dy2/2,alpha);
    dy4=dt*fRK(t(n-1)+dt,yRK4(n-1)+dy3,alpha);
    
    yRK4(n)=yRK4(n-1)+1/6*(dy1+2*dy2+2*dy3+dy4);
end %for

figure(3);
clf;
plot(t,ybar,'o-');
xlabel('t');
ylabel('y(t)');
set(gca,'FontSize',15);
hold on;
plot(t,yRK2,'REPLACE_WITH_DASH_DASH')
plot(t,yRK4,'^-')
ylim([0,8]);
legend('Exact','RK2','RK4')
title('1-d) f(t,y) = -\alpha y');

%1-e
%Gridding in time
%Recalculating below the limit
N=15;                           %Slightly below the limit
t=linspace(tmin,20,N);
dt=t(2)-t(1);

ybar=y0*exp(-alpha*t);

%RK4
yRK4=zeros(1,N);
yRK4(1)=y0;
for n=2:N
    dy1=dt*fRK(t(n-1),yRK4(n-1),alpha);
    dy2=dt*fRK(t(n-1)+dt/2,yRK4(n-1)+dy1/2,alpha);
    dy3=dt*fRK(t(n-1)+dt/2,yRK4(n-1)+dy2/2,alpha);
    dy4=dt*fRK(t(n-1)+dt,yRK4(n-1)+dy3,alpha);
    
    yRK4(n)=yRK4(n-1)+1/6*(dy1+2*dy2+2*dy3+dy4);
end %for

figure(4);
subplot(1,2,1);
plot(t,ybar,'o-');
xlabel('t');
ylabel('y(t)');
set(gca,'FontSize',15);
hold on
plot(t,yRK4,'^-')
legend('Exact','RK4')
title('1-e) \Delta t = 0.7143');

%Recalculating above the limit
N=16;                           %Slightly above the limit
t=linspace(tmin,tmax,N);
dt=t(2)-t(1);

ybar=y0*exp(-alpha*t);

%RK4
yRK4=zeros(1,N);
yRK4(1)=y0;
for n=2:N
    dy1=dt*fRK(t(n-1),yRK4(n-1),alpha);
    dy2=dt*fRK(t(n-1)+dt/2,yRK4(n-1)+dy1/2,alpha);
    dy3=dt*fRK(t(n-1)+dt/2,yRK4(n-1)+dy2/2,alpha);
    dy4=dt*fRK(t(n-1)+dt,yRK4(n-1)+dy3,alpha);
    
    yRK4(n)=yRK4(n-1)+1/6*(dy1+2*dy2+2*dy3+dy4);
end %for

figure(4);
subplot(1,2,2);
plot(t,ybar,'o-');
xlabel('t');
ylabel('y(t)');
set(gca,'FontSize',15);
hold on
plot(t,yRK4,'^-')
% ylim([0,8]);
legend('Exact','RK4')
title('1-e) \Delta t = 0.6667');

%% Problem 2
clc
clearvars
close all

%2-b
lx=50;
x=linspace(-10,10,lx)';
y=cos(x);                   %y def
ytripleprime=sin(x);

figure();
plot(x,y);
hold on;
plot(x,ytripleprime);

dy3_dx=zeros(lx,1);
dx=x(2)-x(1);

den=dx^3;

%forward difference at the beginning
dy3_dx(1)=(y(4)-3*y(3)+3*y(2)-y(1))/den;

for ix=2:lx-2
    dy3_dx(ix)=(y(ix+2)-3*y(ix+1)+3*y(ix)-y(ix-1))/den;
end %for

%backward difference at the end
dy3_dx(lx-1)=(y(lx-1)-3*y(lx-2)+3*y(lx-3)-y(lx-4))/den;
dy3_dx(lx)=(y(lx)-3*y(lx-1)+3*y(lx-2)-y(lx-3))/den;

x=linspace(-10,10,lx)';
plot(x,dy3_dx,'kREPLACE_WITH_DASH_DASH')
legend('Orginal function', 'Analytical', 'Numerical');
xlabel('x');
ylabel('y(x) or y''''''(x)');
title('2-b) Comparison of third derivative approximations');
xlim([0 2*pi]);


%2-d
disp('2-d)');

M = [ -2,2,-4/3,2/3; -1,1/2,-1/6,1/24; 1,1/2,1/6,1/24; 2,2,4/3,2/3];
[L,U] = DLUfactor(M);
nref=length(M);
InvM=[];
for ir=1:nref
    B=zeros(nref,1);
    B(ir) = 1;
    %Forward sub for b'
    Bprime=LTriForwardSub(L,B);
    %Back substitution for x
    x=backsub(cat(2,U,Bprime)); %ith column of the Inverse
    InvM=cat(2,InvM,x);
end %for
disp('Inverse of M:  ');
disp(InvM);

%2-f
disp('2-f');
x=linspace(-10,10,lx)';
y=cos(x);
f4prime=cos(x);

figure();
plot(x,y);
hold on;
plot(x,f4prime);

den=dx^4;
%forward difference at the beginning
dy4_dx(1)=(y(5)-4*y(4)+6*y(3)-4*y(2)+y(1))/den;
dy4_dx(2)=(y(6)-4*y(5)+6*y(4)-4*y(3)+y(2))/den;

for ix=3:lx-2
    dy4_dx(ix)=(y(ix+2)-4*y(ix+1)+6*y(ix)-4*y(ix-1)+y(ix-2))/den;
end %for

%backward difference at the end
dy4_dx(lx-1)=(y(lx-1)-4*y(lx-2)+6*y(lx-3)-4*y(lx-4)+y(lx-5))/den;
dy4_dx(lx)=(y(lx)-4*y(lx-1)+6*y(lx-2)-4*y(lx-3)+y(lx-4))/den;

x=linspace(-10,10,lx)';
plot(x,dy4_dx,'kREPLACE_WITH_DASH_DASH')
legend('Orginal function', 'Analytical', 'Numerical');
xlabel('x');
ylabel('y(x) or y''''''(x)');
title('2-f) Comparison of Fourth derivative approximations');
xlim([0 2*pi]);

%2-g
disp('2-g');
n=6;
for j=1:n
    for k=1:n
        M(j,k)= ((n/2)+1-j)^k/(factorial(k));
        if (n/2)+1-j<=0
            M(j,k)=((n/2)-j)^k/factorial(k);
        end
    end
end
M=flip(M);
disp(M);

%Inverse of M

[L,U] = DLUfactor(M);
nref=length(M);
InvM=[];
for ir=1:nref
    B=zeros(nref,1);
    B(ir) = 1;
    %Forward sub for b'
    Bprime=LTriForwardSub(L,B);
    %Back substitution for x
    x=backsub(cat(2,U,Bprime)); %ith column of the Inverse
    InvM=cat(2,InvM,x);
end %for
disp('Inverse of M:  ');
disp(InvM);


%% Problem 3
clc
clearvars
close all

%Parameters
lamda=2;
dx=1/64;
lx=65;
dt=5*dx^2/(2*lamda);
x=0:dx:1;


tmax=1024*(1/(lamda*2*pi/(2*dx)^2));
t=0:dt:tmax;
lt=numel(t);

%Boundary Conditions
f=zeros(lx,lt);
f(:,lt)=sin(2*pi*x)+sin(8*pi*x);

A=zeros(lx,lx);
b=zeros(1,lx);
%b
ff=f;
%Euler iterations
for n=lt-1:-1:2
    A(1,1)=1;
    b(1)=0; 
    for i=2:lx-1     %interior grid points
        %i-1 coeff
        A(i,i-1)=-lamda/2/dx^2;
        
        %i coeff
        A(i,i)=1/dt+lamda/dx^2;
        
        %i+1 coeff
        A(i,i+1)=-lamda/2/dx^2;
        
        b(i)=ff(i,n+1)/dt+(ff(i+1,n+1)-2*ff(i,n+1)+ff(i-1,n+1))/dx^2*(lamda/2);        
    end %for
    A(lx,lx)=1;
    b(lx)=0;
    
    [Amod,ord] = Gauss_elim(A,b',false);
    fnow=backsub(Amod(ord,:));
    ff(:,n)=fnow;
end %for
ff=flip(ff,2);

%d
fs=f;
%second order iteration
for n=lt-1:-1:2
    A(1,1)=1;
    b(1)=0; 
    for i=2:lx-1     %interior grid points
        %i-1 coeff
        A(i,i-1)=-lamda/dx^2;
        
        %i coeff
        A(i,i)=3/dt+2*lamda/dx^2;
        
        %i+1 coeff
        A(i,i+1)=-lamda/dx^2;
        
        b(i)=(3*fs(i,n+1)+fs(i,n-1))/dt+(ff(i+1,n+1)-2*ff(i,n+1)+ff(i-1,n+1))/dx^2*(lamda);        
    end %for
    A(lx,lx)=1;
    b(lx)=0;
    
    [Amod,ord] = Gauss_elim(A,b',false);
    fnow=backsub(Amod(ord,:));
    fs(:,n)=fnow;
end %for
fs=flip(fs,2);


figure(1);
subplot(131);
imagesc(t,x,ff);
colorbar;
axis xy;
xlabel('time (s)');
ylabel('x (m)')
title('Euler')
set(gca,'FontSize',16);

subplot(132);
imagesc(t,x,fs);
colorbar;
axis xy;
xlabel('time (s)');
ylabel('x (m)')
title('Second order')
set(gca,'FontSize',16);

%Compute and plot the analytical solution (see course repository ./test_problems/ for derivation)
[T,X]=meshgrid(t,x);
exact=exp(-4*pi^2*lamda*T).*sin(2*pi*X)+exp(-64*pi^2*lamda*T).*sin(8*pi*X);

figure(1);
subplot(133);
imagesc(t,x,exact);
colorbar;
axis xy;
xlabel('time (s)');
ylabel('x (m)');
title('Exact');
set(gca,'FontSize',16);
##### SOURCE END #####
--></body></html>